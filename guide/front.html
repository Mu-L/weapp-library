<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序 | 在线借书平台</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/weapp-library/favicon.ico">
    <meta name="description" content="一个连接读者与读书馆的图书资源共享平台">
    
    <link rel="preload" href="/weapp-library/assets/css/0.styles.86dfa422.css" as="style"><link rel="preload" href="/weapp-library/assets/js/app.05bed29b.js" as="script"><link rel="preload" href="/weapp-library/assets/js/2.d06736a6.js" as="script"><link rel="preload" href="/weapp-library/assets/js/5.22a1825c.js" as="script"><link rel="prefetch" href="/weapp-library/assets/js/10.6a078823.js"><link rel="prefetch" href="/weapp-library/assets/js/11.8051156a.js"><link rel="prefetch" href="/weapp-library/assets/js/12.87cf140e.js"><link rel="prefetch" href="/weapp-library/assets/js/3.2195f2d9.js"><link rel="prefetch" href="/weapp-library/assets/js/4.db4230a0.js"><link rel="prefetch" href="/weapp-library/assets/js/6.d8d0b132.js"><link rel="prefetch" href="/weapp-library/assets/js/7.aed282ef.js"><link rel="prefetch" href="/weapp-library/assets/js/8.f3c7476f.js"><link rel="prefetch" href="/weapp-library/assets/js/9.e99af13f.js">
    <link rel="stylesheet" href="/weapp-library/assets/css/0.styles.86dfa422.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weapp-library/" class="home-link router-link-active"><!----> <span class="site-name">在线借书平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/imageslr/weapp-library" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/imageslr/weapp-library" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weapp-library/guide/" aria-current="page" class="sidebar-link">快速了解</a></li><li><a href="/weapp-library/guide/install.html" class="sidebar-link">安装</a></li><li><a href="/weapp-library/guide/feature.html" class="sidebar-link">功能</a></li><li><a href="/weapp-library/guide/front.html" aria-current="page" class="active sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#ui" class="sidebar-link">UI</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#技术栈" class="sidebar-link">技术栈</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#promise-支持" class="sidebar-link">Promise 支持</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#网络请求" class="sidebar-link">网络请求</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#出错处理" class="sidebar-link">出错处理</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#跨页面通信" class="sidebar-link">跨页面通信</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#组件化" class="sidebar-link">组件化</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#文件结构" class="sidebar-link">文件结构</a></li><li class="sidebar-sub-header"><a href="/weapp-library/guide/front.html#代码规范" class="sidebar-link">代码规范</a></li></ul></li><li><a href="/weapp-library/guide/api.html" class="sidebar-link">API</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="小程序"><a href="#小程序" class="header-anchor">#</a> 小程序</h1> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>本页面内容长期未更新，请以 <a href="https://github.com/imageslr/weapp-library" target="_blank" rel="noopener noreferrer">imageslr/weapp-library<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 README 文档和最新代码为准。</p></div> <h2 id="ui"><a href="#ui" class="header-anchor">#</a> UI</h2> <p>利用原型工具 Sketch 与 WeUI 设计工具包，设计了完整的界面原型。遵守 WeUI 视觉规范，对字体大小、列表间距、颜色方案等做了清晰的约定。<a href="/weapp-library/guide/feature.html#运行截图">点击查看</a>更多运行截图，<a href="/weapp-library/ui.sketch">点此下载</a>小程序设计稿。</p> <p><img src="/weapp-library/assets/img/ui.9838e018.png" alt="ui"></p> <h2 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h2> <p>基础库<code>1.9.0</code>以上，尽可能实现<a href="#%E7%BB%84%E4%BB%B6%E5%8C%96">组件化</a></p> <h3 id="mock-数据"><a href="#mock-数据" class="header-anchor">#</a> Mock 数据</h3> <p>本项目采用前后端分离开发。前端采用<a href="https://www.easy-mock.com/project/5aacc9a1d3f6bd35dfb4be65" target="_blank" rel="noopener noreferrer">Easy Mock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>作为 Mock 数据服务器，利用<code>Mock.js</code>生成模拟数据。Easy Mock 是一个纯前端可视化，并且能快速生成模拟数据的持久化服务，可以结合 Swagger 自动生成 API 定义，集成了<code>Mock.js</code>。</p> <div class="custom-block tip"><p class="custom-block-title">2021-04-28 更新</p> <p>Easy Mock 已经失效，目前使用本地 mock server 提供接口，请查看 <a href="https://github.com/imageslr/weapp-library" target="_blank" rel="noopener noreferrer">imageslr/weapp-library<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 README 文档。</p></div> <h2 id="promise-支持"><a href="#promise-支持" class="header-anchor">#</a> Promise 支持</h2> <p>部分操作系统下的小程序不支持<code>Promise</code>，因此需要引入第三方库。由于小程序不支持 dom，因此不能用<code>bluebird.js</code>，只能用<code>es6-promise.js</code>。</p> <h3 id="api-promise化"><a href="#api-promise化" class="header-anchor">#</a> API Promise化</h3> <p>小程序 API 都是以回调函数的形式提供。为了提高代码可读性，采用以下方法将小程序原始 API 封装成支持 <code>Promise</code> 的 API：</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// utils/promisify.js</span>
<span class="token keyword">function</span> <span class="token function">Promisify</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span><span class="token function-variable function">success</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      obj<span class="token punctuation">.</span><span class="token function-variable function">fail</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">fn</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方法：</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Promisify <span class="token keyword">from</span> <span class="token string">'utils/promisify'</span>
<span class="token function">Promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>scan<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'bar'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="添加-finally-方法"><a href="#添加-finally-方法" class="header-anchor">#</a> 添加<code>.finally()</code>方法</h3> <p>见<a href="https://github.com/imageslr/weapp-library/tree/master/utils/promise-polyfill.js" target="_blank" rel="noopener noreferrer">promise-polyfill.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。具体方法如下：</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// 1. 在 /utils/promise-polyfill.js 内引入 Promise 对象</span>
<span class="token keyword">var</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./es6-promise.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 在 app.js 依次引入 es6-promise，promise-polyfill</span>
<span class="token keyword">import</span> Promise <span class="token keyword">from</span> <span class="token string">'./utils/es6-promise'</span>
<span class="token keyword">import</span> promisePolyfill <span class="token keyword">from</span> <span class="token string">'./utils/promise-polyfill'</span>
</code></pre></div><h2 id="网络请求"><a href="#网络请求" class="header-anchor">#</a> 网络请求</h2> <p>为了方便管理和维护，小程序项目根据<a href="https://app.swaggerhub.com/apis/imageslr/weapp/1.0.1#/" target="_blank" rel="noopener noreferrer">API 文档定义<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，按照<code>Model</code>维度，将小程序的网络请求划分为 9 个模块，共 50 余个接口，见<a href="https://github.com/imageslr/weapp-library/tree/master/apis/" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="request-基类方法"><a href="#request-基类方法" class="header-anchor">#</a> request 基类方法</h3> <p>小程序项目在<a href="https://github.com/imageslr/weapp-library/tree/master/apis/request.js" target="_blank" rel="noopener noreferrer">request.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中封装了<code>request</code>方法，提供<code>request拦截</code>、<code>response拦截</code>、<code>统一的错误处理</code>、<code>BASE_URL设置</code>等功能，返回<code>Promise</code>对象，代码如下：</p> <div class="language-JS extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// 远程服务器</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'https://www.library-online.cn/api/public/index.php/api'</span>
<span class="token comment">// 本地服务器</span>
<span class="token comment">// export const BASE_URL = 'http://localhost:8080/library/public/index.php/api'</span>

<span class="token comment">/**
 * request 基类方法
 * 状态码 ≥ 400 时，返回 rejected 状态的 promise
 * @param method 请求方式 必填
 * @param relativeUrl 相对路径 必填
 * @param param 参数 可选
 * @param header 请求头参数 可选
 * @returns {Promise} 返回响应完整内容
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">request</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> relativeUrl<span class="token punctuation">,</span> param<span class="token punctuation">,</span> header</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response<span class="token punctuation">,</span> error
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token constant">BASE_URL</span> <span class="token operator">+</span> relativeUrl<span class="token punctuation">,</span>
      method<span class="token operator">:</span> method<span class="token punctuation">,</span>
      header<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string">'TOKEN'</span><span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 添加用户token</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> param <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">&lt;</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        error <span class="token operator">=</span> err
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">complete</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里打印请求结果</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>本项目的开发环境部署在本地，生产环境部署在腾讯云，测试数据来自 Easy Mock。为方便调试，设置<code>BASE_URL</code>变量，这样只需要切换注释就可以方便地更改 API 基址，见上面代码第 2 行（第一处高亮）。</p> <p>在之前的文档中提到过：客户端存储 token，之后访问每一个 API 时必须在<code>header</code>中添加<code>TOKEN</code>字段（见<a href="/weapp-library/guide/back.html#安全机制">后端-安全机制</a>），因此第 23 行（第二处高亮）在<strong>每个请求</strong>的<code>header</code>中添加了<code>TOKEN</code>字段。</p> <p><code>wx.request</code>方法只要得到服务器响应，无论服务器的状态码是多少，都会走<code>success</code>回调，因此第 28-32 行（第三处高亮）判断服务器返回的状态码，当状态码 ≥<code>400</code>时，返回<code>Promise.reject()</code>。</p> <h3 id="requestwithmodal-方法"><a href="#requestwithmodal-方法" class="header-anchor">#</a> requestWithModal 方法</h3> <p>每次请求失败时，以模态框的形式显示错误信息，见<a href="#%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86">出错处理</a>。</p> <h3 id="get-post-del-方法"><a href="#get-post-del-方法" class="header-anchor">#</a> get / post / del 方法</h3> <p>在<a href="#%E6%98%BE%E7%A4%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"> requestWithModal </a>方法的基础上封装了<code>get</code>、<code>post</code>、<code>del</code>方法，每次发起请求都不需要单独写<code>catch()</code>语句，请求失败时会自动显示错误信息。</p> <h2 id="出错处理"><a href="#出错处理" class="header-anchor">#</a> 出错处理</h2> <h3 id="错误监控"><a href="#错误监控" class="header-anchor">#</a> 错误监控</h3> <p>小程序在运行时会出现许多不可预知的错误，本项目采用<a href="https://docs.fundebug.com/" target="_blank" rel="noopener noreferrer"> Fundebug <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>监控小程序的运行时错误，并在出现错误时以邮件形式向<strong>开发者</strong>发送报警。</p> <p>Fundebug 是全栈 JavaScript 错误实时监控平台。<strong>当用户应用出现错误时，Fundebug 会通过邮件或者第三方工具立即给开发者发送报警</strong>，这样能够帮助开发者及时发现并且解决应用错误，从而提升用户体验。</p> <h4 id="接入方式"><a href="#接入方式" class="header-anchor">#</a> 接入方式</h4> <ol><li>下载 Fundebug 微信小程序插件 <code>fundebug.0.5.0.min.js</code></li> <li>在<code>app.js</code>中引入并配置<code>apikey</code>:</li></ol> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fundebug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/utils/fundebug.0.5.0.min.js'</span><span class="token punctuation">)</span>
fundebug<span class="token punctuation">.</span>apikey <span class="token operator">=</span> <span class="token string">'XXXXXX'</span>
fundebug<span class="token punctuation">.</span>setSystemInfo <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 报警时收集用户设备信息</span>
fundebug<span class="token punctuation">.</span>releaseStage <span class="token operator">=</span> <span class="token string">'production'</span>
</code></pre></div><ol start="3"><li>将<code>https://fundebug.com</code>添加到 request 合法域名</li></ol> <h4 id="控制台截图"><a href="#控制台截图" class="header-anchor">#</a> 控制台截图</h4> <p>如下图，错误信息中包含设备信息、错误栈及统计数据。</p> <p><img src="/weapp-library/assets/img/fundebug-1.ff5a2a3f.png" alt="fundebug"> <img src="/weapp-library/assets/img/fundebug-2.7aa4e7c5.png" alt="fundebug"></p> <h3 id="显示错误信息"><a href="#显示错误信息" class="header-anchor">#</a> 显示错误信息</h3> <p>在之前的文档中提到过：当 API 响应错误时，服务器会返回错误状态码( &gt; 400)以及一个错误对象（见<a href="/weapp-library/guide/api.html#错误对象">API-错误对象</a>)，其中包含给用户看的错误信息<code>message</code>。</p> <p>为了友好地向<strong>小程序用户</strong>展示错误信息，本项目小程序将<code>request</code>进一步封装为<code>requestWithModal</code>方法。每次网络请求失败时，以模态框的形式告知用户发生了什么错误，代码如下：</p> <div class="language-JS extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">/**
 * 请求失败时，显示服务器的错误信息(data.message)或微信的错误信息(errMsg)
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">requestWithModal</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> relativeUrl<span class="token punctuation">,</span> param<span class="token punctuation">,</span> header</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> relativeUrl<span class="token punctuation">,</span> param<span class="token punctuation">,</span> header<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> errMsg
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showLoginModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          errMsg <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          errMsg <span class="token operator">=</span> res<span class="token punctuation">.</span>statusCode <span class="token operator">?</span> <span class="token string">'发生未知错误，请联系开发者'</span> <span class="token operator">:</span> res<span class="token punctuation">.</span>errMsg
        <span class="token punctuation">}</span>
        wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          content<span class="token operator">:</span> errMsg<span class="token punctuation">,</span>
          showCancel<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中第 8-15 行的作用是：</p> <ol><li>当服务器返回<code>401</code>状态码时，显示模态框引导用户登录（第8-10行）</li> <li>当服务器返回错误对象时，<code>res.data</code>属性中会有<code>message</code>属性，显示该错误信息（第11-13行）</li> <li>当得到服务器响应，但服务器没有附带错误信息<code>message</code>时，显示<code>发生未知错误，请联系开发者</code>（第 14 行前半句）</li> <li>当没有得到服务器响应时，比如没信号或者加载时间过长，显示小程序框架返回的错误信息<code>errMsg</code>（第 14 行后半句）</li></ol> <h3 id="页面重新加载"><a href="#页面重新加载" class="header-anchor">#</a> 页面重新加载</h3> <p>本项目使用<a href="https://github.com/imageslr/weapp-library/tree/master/templates/page-status-indicator/index.wxml#L37-L54" target="_blank" rel="noopener noreferrer">页面加载器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>模板表示页面加载状态，当页面加载失败时，用户可以直接点击<code>重新加载</code>刷新页面。</p> <p><img src="/weapp-library/assets/img/page_status_indicator.549977f2.png" alt="页面加载器"></p> <p>使用方法如下：</p> <ol><li>在页面<code>wxml</code>中引入模板</li></ol> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/templates/page-status-indicator/index<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{pageStatus}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page-status-indicator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{pageStatus == <span class="token punctuation">'</span>done<span class="token punctuation">'</span>}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 这里是页面所有内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>在页面<code>js</code>中声明<code>pageStatus</code>属性与<code>onPageReload</code>方法</li> <li>在加载数据的方法中设置<code>pageStatus</code>属性</li></ol> <div class="language-JS extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 页面状态
     * loading：加载中
     * error：获取数据失败，显示重新加载按钮
     * done：成功，显示页面内容
     */</span>
    pageStatus<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
    <span class="token comment">// 其他数据</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 加载页面</span>
  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_loadPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 重新加载页面</span>
  <span class="token function-variable function">onReloadPage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_loadPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">_loadPage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pageStatus<span class="token operator">:</span> <span class="token string">'done'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pageStatus<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 其他方法</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="跨页面通信"><a href="#跨页面通信" class="header-anchor">#</a> 跨页面通信</h2> <p>本项目需要多个场合下跨页面通信，比如这样的业务场景：用户首先进入订单列表页。然后点击其中一个订单，进入到订单详情页。当用户在订单详情页对订单进行操作，例如删除订单、续借图书时，该订单的状态就会发生改变。此时需要更新上一级的订单列表页中该订单的状态。</p> <p>本项目通过<a href="https://github.com/Gozala/events" target="_blank" rel="noopener noreferrer"> Node.js Event 库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现跨页面通信，<code>Node.js Event</code>模块是 Node.js 的核心模块之一，实现了<strong>发布-订阅模式</strong>的通信机制。具体方法如下：</p> <ol><li><code>app.js</code>引入事件总线</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./utils/event'</span> <span class="token comment">// 事件总线</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 全局事件总线</span>
  event<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>在页面<code>onLoad</code>文件内监听事件</li></ol> <div class="language-JS extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">/**
 * /pages/profile/children/order-ongoing.js
 * @listens &lt;orderCanceled&gt;
 * 事件在订单详情页(./children/order-detail)中被触发
 */</span>
<span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 监听事件</span>
  app<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'orderCanceled'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onOrderCanceled<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 事件回调函数</span>
<span class="token function-variable function">onOrderCanceled</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>在其他页面触发事件</li></ol> <div class="language-JS extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token comment">// pages/profile/children/children/order-detail.js</span>
<span class="token function-variable function">_onAction</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">func</span><span class="token punctuation">(</span><span class="token constant">ORDER_ID</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'orderCanceled'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> order <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="组件化"><a href="#组件化" class="header-anchor">#</a> 组件化</h2> <p>在线借书平台小程序——我的——组件展示</p> <p><img src="/weapp-library/assets/img/component.f30eef19.png" alt="组件展示"></p> <h2 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h2> <p><a href="https://github.com/imageslr/weapp-library" target="_blank" rel="noopener noreferrer">在 GitHub 上查看<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>.
├── apis                  // 网络请求
│   ├── request.js        // get/post/delete封装
│   ├── book.js           // /books api封装
│   └── xxx.js            // /xxxs api封装
├── app.js
├── app.json
├── app.wxss
├── component-demos       // 组件展示
├── components            // 可复用组件
│   ├── async-button      // 异步按钮
│   ├── async-switch      // 异步切换器
│   ├── collapse          // 可折叠容器
│   ├── load-more         // 加载更多
│   ├── no-data           // 暂无数据
│   ├── panel             // 带导航标题的面板
│   ├── popup             // 底部弹出层
│   ├── rate              // 可评半星的评分组件
│   ├── search-bar        // 带遮罩的搜索框
│   ├── send-code         // 发送验证码按钮
│   ├── spinner           // 加载中动画
│   ├── sticky            // 固定页头
│   ├── sticky-2          // 固定页头的另一种实现
│   ├── tab-bar           // 标签页
│   ├── toast             // 弹出提示
│   └── toptip            // 顶部提示
├── images                // 图标
├── package.json
├── pages                 // 页面，子页面在父页面的children文件夹中
│ └─components            // 与业务相关的特殊组件
├── project.config.json
├── styles                // 样式
├── templates             // 模板
│   ├── library-list      // 图书馆列表
│   ├── page-status-indicator // 页面加载状态，带有一个“重新加载”按钮
│   └── showcase          // 图书项目
└── utils                 // 辅助模块
    ├── biz-helper.wxs    // 业务相关辅助函数，用于wxml中
    ├── constant.js       // 业务常量
    ├── constant.wxs      // 业务常量，用于wxml中
    ├── es6-promise.js    // Promise语法支持
    ├── event.js          // 全局事件
    ├── permission.js     // 登录鉴权
    ├── promise-polyfill.js // Promise.finally()语法
    ├── promisify.js      // 微信小程序API Promise化
    ├── qrcode.js         // 二维码生成
    ├── tip.js            // 使用帮助
    ├── utils.js          // 辅助函数
    ├── validator.js      // 正则校验器
    └── fundebug.js       // 错误监控
</code></pre></div><h2 id="代码规范"><a href="#代码规范" class="header-anchor">#</a> 代码规范</h2> <p>遵循 <a href="https://standardjs.com/readme-zhcn.html" target="_blank" rel="noopener noreferrer">JavaScript Standard Style<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/imageslr/weapp-library/edit/master/docs/guide/front.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/30/2021, 12:11:37 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/weapp-library/guide/feature.html" class="prev">
        功能
      </a></span> <span class="next"><a href="/weapp-library/guide/api.html">
        API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/weapp-library/assets/js/app.05bed29b.js" defer></script><script src="/weapp-library/assets/js/2.d06736a6.js" defer></script><script src="/weapp-library/assets/js/5.22a1825c.js" defer></script>
  </body>
</html>
